---
title: "01-SiteLevel"
author: "Galina M. Jönsson"
date: "12/10/2020"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---
# Notes (remove before sub)
* See further Qs where I've written "TOM" in below text  
* The figures used in the thesis are not publication standard but I'll reproduce once you know which journal you're going for  
* In short for your understanding:  the optimal model is a type of mixture model known as a zero inflated negative binomial (**ZINB**) GLMM. The underlying process is such that in the count process (i.e. of *Bulinus* in the field), you sometimes counted zero snails because the snails don’t like the covariates, or due to that you didn't have time to sieve through the whole freakin pond and/or snails were difficult to observe. Hence the resulting survey data fall into three categories: snails were collected, snails were present but not collected (false zeroes) and snails were not present and not collected (true zeroes). ZINBs are called mixture models because the zeros are modelled as coming from two different processes: the binomial process and the count process. the binomial GLM models the probability of measuring a false positive versus all other types of data (counts and true zeros), whilst the count process (non zeros and true zeros) is modelled by a  negative binomial (ZINB) GLMM. 
* Note that glmmTMB() fits the model using the Laplace approximation - this should probably be mentined in the ms... or not... hmm 


## The data
```{r loadNclean-data}
### load data
siteDF <- read.csv("../Data/TempTom/df2_new.csv")



### Subset columns of interest
keeps <- c("USI", "shehia", "survey", "type", "wbtype2", "wlevel", "BgBn_pres", "BgBn_number", "temp", "ph", "cond", "Bulinus_xeno", "Sh", "Sh_pres", "Sh_prev", "lat_cor", "lon_cor", "survey_date")

siteDF <- siteDF[keeps]



### Change variables to appropriate classes
siteDF$site <- as.factor(siteDF$USI)
siteDF$survey <- as.factor(siteDF$survey)
siteDF$shehia <- as.factor(siteDF$shehia)
siteDF$type <- factor(siteDF$type, ordered = TRUE, 
                                levels = c("HNR", "HD", "LNR", "LD"))
siteDF$wbtype2 <- as.factor(siteDF$wbtype2)
siteDF$wlevel <- factor(siteDF$wlevel, ordered = TRUE, 
                                levels = c("1", "2", "3", "4"))
siteDF$BgBn_pres <- as.factor(siteDF$BgBn_pres)



### remove surveys that were not conducted
siteDF <- siteDF[complete.cases(siteDF[ , "BgBn_number"]),]
```


### Visualise response variable
Number of *Bulinus* individuals collected per survey
```{r respvar, cache=TRUE, message=FALSE}
require(ggplot2)
p <- ggplot(siteDF,aes(x=BgBn_number))+
  stat_count(position="identity",alpha=0.5,width = 1)+theme()
p <- p + labs(y = "Density",x = "Number of snails")
p
```



\n

The response variable is heavily zero inflated. I.e. most surveys did not collect any *Bulinus* individuals.


### Test for collinearity between explanatory variables
\n
\n
#### Explanatory variables of potential interest
* **wlevel** -> water level    
* **wbtype2** -> waterbody type: either permanent or temporary    
* **syrvey** -> four surveys; corresponds to time of year; potentially correlated with wlevel and wbtype2    
* **temp** -> water temperature   
* **cond** -> conductivity; indirect measure of water chemistry   
* **ph** -> potentially correlated with conductivity   
* **type** -> human response to treatment; whether people got reinfected quickly or not; four categories    


Potential collinearity between quantitative explanatory variables is tested using the Kendall rank coefficient to establish whether variables are statistically dependent. This test is non-parametric, i.e. does not rely on any assumptions on the distributions of the variables. Collinearity between qualitative and quantitative explanatory variables is visually examined using box plots. 
```{r collinearity-explanVars-test, message=FALSE, warning=FALSE, cache=TRUE}
require("PerformanceAnalytics")
require("ggplot2")
require("ggpubr")


### Quantitative explanatory variables: Kendall rank coefficient
chart.Correlation(siteDF[,c("temp", "ph", "cond")], 
                  histogram=TRUE, pch=19, method = "kendall")



### Qualitative and quantitative explanatory variables

## Qualitative variables and temp
ggarrange(ggplot(siteDF, aes(x = type, y = temp)) + geom_boxplot(),
          ggplot(siteDF, aes(x = wbtype2, y = temp)) + geom_boxplot(),
          ggplot(siteDF, aes(x = survey, y = temp)) + geom_boxplot(),
          ggplot(siteDF, aes(x = wlevel, y = temp)) + geom_boxplot() + rremove("x.text"), 
          labels = c("type", "wbtype2", "survey", "wlevel"),
          ncol = 2, nrow = 2)

## Qualitative variables and pH
ggarrange(ggplot(siteDF, aes(x = type, y = ph)) + geom_boxplot(),
          ggplot(siteDF, aes(x = wbtype2, y = ph)) + geom_boxplot(),
          ggplot(siteDF, aes(x = survey, y = ph)) + geom_boxplot(),
          ggplot(siteDF, aes(x = wlevel, y = ph)) + geom_boxplot() + rremove("x.text"), 
          labels = c("type", "wbtype2", "survey", "wlevel"),
          ncol = 2, nrow = 2)

## Qualitative variables and pH
ggarrange(ggplot(siteDF, aes(x = type, y = cond)) + geom_boxplot(),
          ggplot(siteDF, aes(x = wbtype2, y = cond)) + geom_boxplot(),
          ggplot(siteDF, aes(x = survey, y = cond)) + geom_boxplot(),
          ggplot(siteDF, aes(x = wlevel, y = cond)) + geom_boxplot() + rremove("x.text"), 
          labels = c("type", "wbtype2", "survey", "wlevel"),
          ncol = 2, nrow = 2)
```




\n

Temperature and pH are negatively correlated (p<0.001). From hereon, only temperature will be used in analyses. Temperature and conductivity show some positive correlation although not statistically significant (p=0.1).




## Model selection

The variables used in initial model selection are as follows: 

#### Response variable 
* **BgBn_number** -> The number of *Bulinus* individuals collected per survey  


#### Explanatory variables of potential interest
* **wlevel** -> water level    
* **wbtype2** -> waterbody type: either permanent or temporary    
* **syrvey** -> four surveys; corresponds to time of year; potentially correlated with wlevel and wbtype2; this vaiable will not be dropped in any model simplification as it accounts for **known differences in snail abundance** (TOM!?) between different seasons.  
* **temp** -> water temperature   
* **cond** -> conductivity; indirect measure of water chemistry   
* **ph** -> potentially correlated with conductivity   
* **type** -> human response to treatment; whether people got reinfected quickly or not; four categories    



#### Random factors   
* **shehia** -> regions/wards on Pemba
* **site** -> sites within shesias; hence, site is nested within shehia in models


Given the variables described above, we must use a type of generalised linear mixed effects model to test what effects the number of snails collected per survey. 

### Distributions
First, we test which distribution best fits the data in a maximal model (i.e. including all potential explanatory variables and the random factors). As the response variable is count data, we test both the Poisson and the negative binomial distribution. Moreover, as the response variable is zero inflated, we also test whether the inclusion of a zero inflation parameter improves model fit for the Poisson and the negative binomial distribution. Model fit is evaluated based on visual inspection of QQ plots, AIC and likelihood ratio tests (variance structure).

```{r glmer-BgBn_number-Distributions, message=FALSE, warning=FALSE, cache=TRUE}
require(lme4)
require(devtools)
#devtools::install_github("glmmTMB/glmmTMB/glmmTMB")
require(glmmTMB)
require(DHARMa)
require(lmtest)

## load (installing if necessary) the checkpoint package
while (!require("checkpoint")) install.packages("checkpoint")
## retrieve build date of installed version of TMB
bd <- as.character(asDateBuilt(packageDescription("TMB",fields="Built")))
oldrepo <- getOption("repos")
setSnapshot(bd)
install.packages("Matrix")
options(repos=oldrepo) ## restore original repo


######################################################################
######################## Poisson Distribution ########################
######################################################################

# Fit maximal model
glmm.poisson <- glmer(BgBn_number ~ wbtype2 + wlevel + type + survey +
                 temp + cond +
                 (1|shehia/site), data=siteDF, family = "poisson")

# test for zero-inflation
testZeroInflation(simulateResiduals(glmm.poisson,  n = 1000)) # Evidence suggesting zero inflation 

# Plot fit
plot(simulateResiduals(glmm.poisson,  n = 1000), rank = TRUE)


######################################################################
################ Zero Inflated Poisson Distribution ##################
######################################################################

# Fit maximal model
glmm.ZIpoisson <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                          temp + cond + 
                          (1|shehia/site), data=siteDF,
                         ziformula=~1, # one zero inflation parameter applying to all observations
                         family=poisson)

# Plot fit
plot(simulateResiduals(glmm.ZIpoisson,  n = 1000), rank = TRUE)





######################################################################
################# Negative Binomial Distribution #####################
######################################################################

# Fit maximal model
glmm.nb <- glmer.nb(BgBn_number ~ wbtype2 + wlevel + type + survey +
                         temp + cond + 
                          (1|shehia/site), data=siteDF)
# test for zero-inflation
testZeroInflation(simulateResiduals(glmm.nb,  n = 1000)) # No evidence for zero inflation 

# Plot fit
plot(simulateResiduals(glmm.nb,  n = 1000), rank = TRUE)



######################################################################
########## Zero Inflated Negative Binomial Distribution ##############
######################################################################

# Fit maximal model
glmm.ZInb <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                         temp + cond + 
                          (1|shehia/site), data=siteDF,
                         ziformula = ~1,
                         family = nbinom2)

# Plot fit
plot(simulateResiduals(glmm.ZInb,  n = 1000), rank = TRUE)





######################################################################
########################## Model Comparison ##########################
######################################################################
require(lmtest)

### Likelihood ratio tests

# Poison vs zero inflated Poisson
lrtest(glmm.poisson, glmm.ZIpoisson)

# Negative binomial vs Poison 
lrtest(glmm.nb, glmm.ZIpoisson)

# Negative binomial vs  zero inflated negative binomial
lrtest(glmm.nb, glmm.ZInb)


### AIC
AIC(glmm.poisson, glmm.ZIpoisson, glmm.nb, glmm.ZInb)
```


\n

The inclusion of a zero inflation parameter improves model fit for the Poisson distribution, as evident from the likelihood ratio test (p < 2.2e-16), AIC (6716 vs 4550) and visual inspection of QQ plots. However, the negative binomial distribution fits the data better than the zero inflated Poisson distribution (likelihood ratio test: p < 2.2e-16; AIC: 1745 vs 4550). Again, the inclusion of a zero inflation parameter improves model fit for the negative binomial distribution as well, although improvements aren't as significant as in the case of the Poisson distribution. Nonetheless, a zero inflated negative binomial distribution gives the best fit and will be used to fit the data. 




\n
\n
\n
\n
\n

### Variables
Now we test which of the explanatory variables can be dropped from the maximal model. We drop each term in turn and select the optimal model using the likelihood ratio test and AIC. Note that we fit the models using a subset of the surveys which have measurements for all explanatory variables.

```{r glmer-BgBn_number-nb-min-models1, message=FALSE, warning=FALSE, cache=TRUE}
# Fit maximal model
glmm.ZInb.max <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                         temp + cond + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                     data=siteDF[complete.cases(siteDF[ , c("temp", "cond")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop wbtype2
glmm.ZInb.min.1 <- glmmTMB(BgBn_number ~ wlevel + type + survey +
                         temp + cond + 
                          (1|shehia/site), 
                         contrasts=list(wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                      data=siteDF[complete.cases(siteDF[ , c("temp", "cond")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop wlevel
glmm.ZInb.min.2 <- glmmTMB(BgBn_number ~ wbtype2 + type + survey +
                         temp + cond + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                      data=siteDF[complete.cases(siteDF[ , c("temp", "cond")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop type
glmm.ZInb.min.3 <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + survey +
                         temp + cond + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        wlevel="contr.sum", 
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp", "cond")]),],
                         family = nbinom2)

# Drop temp
glmm.ZInb.min.4 <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                         cond + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp", "cond")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop cond
glmm.ZInb.min.5 <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp", "cond")]),],
                         ziformula = ~1,
                         family = nbinom2)


### Model comparison

# Likelihood ratio tests
require(lmtest)
lrtest(glmm.ZInb.max, glmm.ZInb.min.1); lrtest(glmm.ZInb.max, glmm.ZInb.min.2)
lrtest(glmm.ZInb.max, glmm.ZInb.min.3); lrtest(glmm.ZInb.max, glmm.ZInb.min.4)
lrtest(glmm.ZInb.max, glmm.ZInb.min.5)

# AIC
AIC(glmm.ZInb.max, glmm.ZInb.min.1, glmm.ZInb.min.2, glmm.ZInb.min.3, glmm.ZInb.min.4, glmm.ZInb.min.5)
```

\n


The model, in which "cond" was dropped from the count data model (glmm.ZInb.min.5) had an associated p-value of 0.9106 and although it did not have the lowest AIC (1740), it had the second lowest AIC value; therefore, we drop the "cond" term. 

As these test are approximate and the AICs of models with and without "cond" are very similar in terms of AIC-values, we test whether dropping another term improves model fit further. 

```{r glmer-BgBn_number-nb-min-models2, message=FALSE, warning=FALSE, cache=TRUE}
# Refit glmm.ZInb.min.5
glmm.ZInb.min.5 <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)



# Drop wbtype2
glmm.ZInb.min.5.1 <- glmmTMB(BgBn_number ~ wlevel + type + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)


# Drop wlevel
glmm.ZInb.min.5.2 <- glmmTMB(BgBn_number ~ wbtype2 + type + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop type
glmm.ZInb.min.5.3 <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(wbtype2="contr.sum", 
                                        wlevel="contr.sum", 
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop temp
glmm.ZInb.min.5.4 <- glmmTMB(BgBn_number ~ wbtype2 + wlevel + type + survey +
                          (1|shehia/site), 
                         contrasts=list(wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)


### Model comparison

# Likelihood ratio tests
require(lmtest)
lrtest(glmm.ZInb.min.5, glmm.ZInb.min.5.1); lrtest(glmm.ZInb.min.5, glmm.ZInb.min.5.2)
lrtest(glmm.ZInb.min.5, glmm.ZInb.min.5.3); lrtest(glmm.ZInb.min.5, glmm.ZInb.min.5.4)

# AIC
AIC(glmm.ZInb.min.5, glmm.ZInb.min.5.1, glmm.ZInb.min.5.2, glmm.ZInb.min.5.3, glmm.ZInb.min.5.4)
```

\n


Likelihood ratio tests revealed that the model, in which "wlevel" was dropped from the count data model (glmm.ZInb.min.5.2) gave an associated p-value of 0.8239 but also the lowest AIC (1746.647) among all models tested. However, dropping "wbtype2" (glmm.ZInb.min.5.1) gave a p-value of 0.5574 (and both wbtype 2 and wlevel are likely to be correlated) so we decide to keep "wlevel" and drop "wbtype2", and test whether dropping another term improves model fit further.  


```{r glmer-BgBn_number-nb-min-models3, message=FALSE, warning=FALSE, cache=TRUE}
# Drop wlevel
glmm.ZInb.min.5.1.1 <- glmmTMB(BgBn_number ~ type + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop type
glmm.ZInb.min.5.1.2 <- glmmTMB(BgBn_number ~ wlevel + survey +
                         temp + 
                          (1|shehia/site),  
                         contrasts=list(wlevel="contr.sum", 
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)

# Drop temp
glmm.ZInb.min.5.1.3 <- glmmTMB(BgBn_number ~ wlevel + type + survey +
                          (1|shehia/site), 
                         contrasts=list(wlevel="contr.sum", 
                                        type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)


### Model comparison

# Likelihood ratio tests
require(lmtest)
lrtest(glmm.ZInb.min.5.1, glmm.ZInb.min.5.1.1); lrtest(glmm.ZInb.min.5.1, glmm.ZInb.min.5.1.2)
lrtest(glmm.ZInb.min.5.1, glmm.ZInb.min.5.1.3)

# AIC
AIC(glmm.ZInb.min.5.1, glmm.ZInb.min.5.1.1, glmm.ZInb.min.5.1.2, glmm.ZInb.min.5.1.3)
```

Likelihood ratio tests revealed that the model, in which "wlevel" was dropped from the count data model (glmm.ZInb.min.5.1.1) gave an associated p-value of 0.8057 and the lowest AIC (1735.668). Therefore, we also drop "wlevel", making our final model glmm.ZInb.min.5.1.1. 




## Test for autocorrelation
Test whether there is evidence for spatial or temporal autocorrelation. 

### Temporal autocorrelation 

Here we test for temporal autocorrelation using Julian dates; hence, assuming that day within a year is a key factor whilst the year itself isn't. The data used here was collected over two years (2017 and 2018) which **TOM** do you know whehther they were somewhat similar or at least not extremely different wether-wise? 
```{r glmm.ZInb.min.5.1.1-autocorrelation-temp, cache=TRUE, message=FALSE}
require(DHARMa)
require(glmmTMB)

### Refit final model
glmm.ZInb.min.5.1.1 <- glmmTMB(BgBn_number ~ type + survey +
                         temp + 
                          (1|shehia/site), 
                         contrasts=list(type="contr.sum",
                                        survey="contr.sum"),
                         data=siteDF[complete.cases(siteDF[ , c("temp")]),],
                         ziformula = ~1,
                         family = nbinom2)


### Load the raw data
mydata <- (siteDF[complete.cases(siteDF[, c("BgBn_number", "survey", 
                                           "temp", "shehia", "site", "lat_cor", "lon_cor", "survey_date")]),])

# Fix three dates that were entered incorrectly: month 17 instead of 07
mydata$survey_date <- gsub("20/17/2018","20/07/2018",mydata$survey_date)

# make a copy of survey_date that is a date class
mydata$survey_date2 <- as.Date(mydata$survey_date, format = "%d/%m/%Y")

# Change all years to 2017 (see reasoning above)
require(lubridate)
year(mydata$survey_date2) <- 2017

# Create a column with Julian dates
mydata$myjulian <- julian(mydata$survey_date2, origin = as.Date("2017-01-01"))


res <- simulateResiduals(glmm.ZInb.min.5.1.1)

# testing grouped residuals 
res <- recalculateResiduals(res, group <- mydata$myjulian)
testTemporalAutocorrelation(res, time <- unique(mydata$myjulian))
```

We get a p-value greater than 0.05 and can therefore reject the alternative hypothesis (true autocorrelation is not 0) and assume that our "survey" variable satisfactory accounts for any temporal autocorrelation.  

### Spatial autocorrelation 

```{r glmm.ZInb.min.5.1.1-autocorrelation-spatial, cache=TRUE, message=FALSE}
## Spatial
require(DHARMa)
E <- simulateResiduals(glmm.ZInb.min.5.1.1,  n = 1000)

E2 <- resid(glmm.ZInb.min.5.1.1)
require(gstat)
require(sp)
mydata <- (siteDF[complete.cases(siteDF[, c("BgBn_number", "type", "survey",
                                           "temp", "shehia", "site", "lat_cor", "lon_cor", "survey_date")]),])
mydata <- data.frame(E2, mydata$lon_cor, mydata$lat_cor)
coordinates(mydata) <- c("mydata.lon_cor","mydata.lat_cor")
bubble(mydata, "E2", col = c("black","grey"),
main = "Residuals", xlab = "X-coordinates", ylab = "Y-coordinates")

testSpatialAutocorrelation(glmm.ZInb.min.5.1.1, x = mydata$lat_cor, y = mydata$lon_cor)
testSpatialAutocorrelation(E, x = mydata$lat_cor, y = mydata$lon_cor)

Vario1 <- variogram(E2 ~ 1, mydata)
plot(Vario1)
```
We get a p-value greater than 0.05 and can therefore reject the alternative hypothesis (existance of Spatial autocorrelation that is not accounted for by the nested random ractors shehia and site)




## Results

### Overview
First, we look at the summary of our model and then use a type III Wald chisquare test to test whether any of the explanatory variables affect the number of *Bulinus* individuals collected per survey. Thereafter, we plot the effects of the explanatory variables before going through them one by one (below). 
```{r glmm.ZInb.min.5.1.1-Overview, cache=TRUE, message=FALSE, warning=FALSE}
require(glmmTMB)
require(car)
require(effects)

summary(glmm.ZInb.min.5.1.1)

car::Anova(glmm.ZInb.min.5.1.1, type="III")

effects_ok <- (requireNamespace("effects") && getRversion() >= "3.6.0")
if (effects_ok) {
(ae <- allEffects(glmm.ZInb.min.5.1.1))
plot(ae)
}
```
\n
\n


**TOM** Recall that this is a mixture model! 
The summary shows that:
* The logistic model for the false zeros is statistically significant (p=4.01e-07)  
* All Estimated slopes, SDs, z values and p values of the summary should be presented somewhere (the Zero-inflation model intercept is that of the logistic model)  
* The overdispersion parameter value should be included in publication  


The type III Wald chisquare test shows:
* type and survey effect the number of snails collected whilst temperature doesn't  



### Temperature
The effect plots show that there appears to be a negative effect on snail numbers with increasing temperatures but this is not statistically significant (X2 = 2.4106, df = 1, p = 0.120) within the range and with the data used here
\n
\n



### Type
The effect of type on snail abundance is statistically significant (X2 = 14.8, df = 3, p = 0.002)! The predicted responses are that ponds in type LD areas would on average have 0.881 snails, whilst HNR, HD and LNR areas would have 61.5, 40.7 and 33.8 snails (**TOM** do these numbers sound reasonable?!?!). A post-hoc pairwise Tukey Contrast test shows that there is no statistically significant difference between HNR, HD and LNR areas, whilst all three aforementioned area types are statistically different (have more snails) than LD areas. 
```{r glmm.ZInb.min.5.1.1-type, cache=TRUE}
require(emmeans)
require(multcomp)

emmeans(glmm.ZInb.min.5.1.1, c("type"), data = siteDF[complete.cases(siteDF[ , c("temp")]),], type = "response")

tukeyType <- glht(glmm.ZInb.min.5.1.1, linfct = mcp(type = "Tukey"))
summary(tukeyType)
```


### Survey

The effect of survey on snail abundance is statistically significant (X2 = 16.2, df = 3, p = 0.001)! The predicted responses are that on average, 38.2, 15.9, 9.7 and 12.6 snails were present in ponds during surevy S1, S2, S3 and S4, respectively (**TOM** do these numbers sound reasonable?!?! Remember that we now have accounted for snailes you did not collect but were present with the model formulation). A post-hoc pairwise Tukey Contrast test shows that there is no statistically significant difference between survey 2, 3 and 4, whilst all three aforementioned surveys are statistically different (have fewer snails) than survey 1. 

\n
```{r glmm.ZInb.min.5.1.1-survey, cache=TRUE}
require(emmeans)
require(multcomp)

emmeans(glmm.ZInb.min.5.1.1, c("survey"), data = siteDF[complete.cases(siteDF[ , c("temp")]),], type = "response")

tukeySurvey <- glht(glmm.ZInb.min.5.1.1, linfct = mcp(survey = "Tukey"))
summary(tukeySurvey)
```


\n